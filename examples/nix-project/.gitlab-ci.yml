# Example: Nix project using runner components
#
# This shows how to use the nix runner with Attic cache integration.

include:
  - component: gitlab.com/<your-group>/attic-iac/nix-job@main
    inputs:
      attic_server: "https://attic-cache.example.com"
      push_to_cache: true

stages:
  - build
  - check

build:
  extends: [.component-job]
  script:
    - nix build .#default
    - |
      if [ "$PUSH_TO_CACHE" = "true" ] && [ -n "$ATTIC_TOKEN" ]; then
        attic push main result || echo "Cache push failed (non-fatal)"
      fi
  artifacts:
    paths:
      - result
    expire_in: 1 week

check:
  extends: [.component-job]
  stage: check
  script:
    - nix flake check
